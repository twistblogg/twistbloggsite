import { usePost } from "@reflexjs/gatsby-theme-post"

export const RelatedPosts = ({ slug, tags, limit = 3 }) => {
  const posts = usePost()
  if (!tags) return null
  const tagsName = tags.map(({ name }) => name)
  const relatedPosts = posts.filter(
    ({ slug: postSlug, tags }) =>
      tags.filter(({ name }) => tagsName.includes(name)).length &&
      slug !== postSlug
  )
  if (!relatedPosts.length) return null  
  return (
    <Section mt="10" py="8" mb="10" pl="5" pr="5">
      <H3 textAlign="center" mb="12" fontSize="3xl">
        Navigate More Cool Stuffs
      </H3>
      <Grid col="1|2|2|3" maxW="1200" mx="auto" gap="10">
        {relatedPosts.slice(0, limit).map((post) => (
          <Span boxShadow="3xl" borderRadius="2xl" bg="muted"><Article key={post.slug}>
            <Link to={post.slug} d="block">
              <Image src={post.image} aspectRatio={16 / 9} />
            </Link>
            <H4 pt="2" pb="10" pl="2" pr="2" textAlign="center" mt="4" mb="0" fontSize="xl" lineHeight="normal">
              <Link to={post.slug}>{post.title}</Link>
            </H4>
          </Article></Span>
        ))}
      </Grid>
    </Section>
  )
}